<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */
div.tooltip {
	position: absolute;
	text-align: center;
	width: 60px;
	height: 28px;
	padding: 2px;
	font: 12px sans-serif;
	background: lightsteelblue;
	border: 0px;
	border-radius: 8px;
	pointer-events: none;
}

#my_dataviz{
	width: 400px;
	height: :auto;
}


#my_dataviz_line { 
	stroke: steelblue;
	stroke-width: 2;
	fill: none;
}

/*.axis path,
.axis line {
	fill: none;
	stroke: grey;
	stroke-width: 1;
	shape-rendering: crispEdges;
	}*/

</style>

<script src="https://d3js.org/d3.v4.min.js"></script> <!-- Load d3.js -->
<script type="text/javascript"  src="./d3-scale-radial.js"></script> <!-- Function for radial charts -->
<!--<script src="d3-tip.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>


<script type="text/javascript"  src="./functionUtils.js"></script> <!-- Function for radial charts -->

<body>

	<div id="my_dataviz" >
		<h1 align="center">Analyse de la fonte des glaces au pôle nord</h1>
		<p>Escargot représentant l'évolution de la glace en fonction des années, de 1979 à 2016</p>
	</div> <!-- Create a div where the graph will take place -->
	<div id="my_dataviz_line">
		<p>Escargot représentant l'évolution de la glace en fonction des années, de 1979 à 2016</p>
	</div>
	<script>
		
		// set the dimensions and margins of the graph
		var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 460 - margin.left - margin.right,
		height = 460 - margin.top - margin.bottom,
		innerRadius = 80,
		outerRadius = Math.min(width, height) / 2;   // the outerRadius goes from the middle of the SVG area to the border

		var snailBase = "#00000";
		var snailTransi = "#11111";

		// append the svg object to the body of the page
		var svg = d3.select("#my_dataviz")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform", "translate(" + width / 3 + "," + ( height/2 )+ ")"); // Add 100 on Y translation, cause upper bars are longers


		// Div de tooltip pour le cercle
		var tooltip = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("opacity", 0);

		// Cercle julien ! 
		/*var svg = d3.select("body").append("svg")
		.attr("width", 1000)
		.attr("height", 500)*/

		var g = svg.append("g")



		d3.csv("./data/north_mean_extent_year.csv", function(data) {

			// X scale
			var x = d3.scaleBand()
			.range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = allaround the circle. If I stop at 1Pi, it will be around a half circle
			.align(0)                  // This does nothing ?
			.domain( data.map(function(d) { return d.Year; }) ); // The domain of the X axis is the list of states.

			// Y scale
			var y = d3.scaleRadial()
			.range([innerRadius, outerRadius])   // Domain will be define later.
			.domain([10, 13]); // Domain of Y is from 0 to the max seen in the data


			var colorScale=d3.scaleLinear()
			.domain([10,13])
			.range(["white",  "#3399FF"]);

			// Add bars
			svg.append("g")
			.selectAll("path")
			.data(data)
			.enter()
			.append("path")
			.attr("fill", function (i) { return colorScale (i.mean_extent);})
			//.attr("text", "ok")
			.attr("d", d3.arc()     // imagine your doing a part of a donut plot
				.innerRadius(innerRadius)
				.outerRadius(function(d) { return y(d['mean_extent']); })
				.startAngle(function(d) { return x(d.Year); })
				.endAngle(function(d) { return x(d.Year) + x.bandwidth(); })
				.padAngle(0.1)

				.padRadius(innerRadius)
				)

			// Au passage de la souris
			.on("mouseover", function(d){
				displayTooltip(this);

				//divAnneeTest(d.Year);
				divAnnee(d.Year, (d3.event.pageX), (d3.event.pageY - 28));
				getTemp(d.Year);

                // Ajout des map de france
				displayFrance(d)
			})

			// Lorsque l'on retire la souris
			.on("mouseout", function(d){
				hideTooltip(this);

				d3.selectAll("#my_dataviz_line > *").remove(); 
				
				

			});


			var text = svg.selectAll("text")
                .data(data)
                .enter()
                .append("text");

            var textLabels = text
            	.attr("x", function(d){ 
            		if(d.Year=="1979" || d.Year=="1997") 
            			return 0; 
            		else 
            			return 150;  })
            	.attr("y", function(d){ 
            		if(d.Year=="1979") 
            			return -170; 
            		else 
            			return 170; 
            	})
                .text( function (d) { if(d.Year=="1979" || d.Year=="1997") return d.Year; })
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("fill", "black");














		});


		// Tooltip div
		var parseDate = d3.timeParse("%m/%d/%Y");
		var max = 0;

		var xNudge = 50;
		var yNudge = 20;

		/*var minDate = new Date();
		var maxDate = new Date();*/
		var minDate = 2500;
		var maxDate = 0;

		d3.csv("./data/north_mean_extent.csv")
		.row(function(d) 
			{ return { year: parseInt(d.Year), month: parseInt(d.Month), mean_extent: Number(d.mean_extent.trim())}; })
		.get(function(error, rows) {
			max = d3.max(rows, function(d) { return d.mean_extent; });
			minDate = d3.min(rows, function(d) { return d.month; });
			maxDate = d3.max(rows, function(d) { return d.month; });
		});

		d3.csv("./data/ArcticTemp.csv")
		.row(function(d) 
			{ return { year: parseInt(d.Year), month: parseInt(d.Month), temp: Number(d.Temperature.trim())}; })
		.get(function(error, rows) {
			minTemp = d3.min(rows, function(d){return d.temp})
			maxTemp = d3.max(rows, function(d) { return d.temp; });
			minDateTemp = d3.min(rows, function(d) { return d.month; });
			maxDateTemp = d3.max(rows, function(d) { return d.month; });
		});

		var heightDivLineChart = 200;
		var widthDivLineChart = 500;
		var heightLineChart = 100;
		var widthLineChart = 400;
		

	</script>
</body>
